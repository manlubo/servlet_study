<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="mapper.BoardMapper">
 	<sql id="criteria">
 		<where>
 			<trim prefixOverrides="AND | OR">
 			<if test="cno != null">
		 		cno = #{cno}
 			</if>
 			<if test="types != null">
 				<foreach collection="types" item="t" open="and(" close=")" separator="or">
 					<choose>
 						<when test="t eq 'T'.toString">
 							title like concat('%', #{keyword}, '%')
 						</when>
 						<when test="t eq 'C'.toString">
 							content like concat('%', #{keyword}, '%')
 						</when>
 						<when test="t eq 'I'.toString">
 							id like concat('%', #{keyword}, '%')
 						</when>
 					</choose>
 				</foreach>
 			</if>
 			</trim>
 		</where>
 	</sql>
 	
 	<!-- 글 등록 -->
 	<insert id="insert">
 		insert into 
 		tbl_board(id, title, content, cno) 
 		values (#{id}, #{title}, #{content}, #{cno})
 		<selectKey keyProperty="bno" resultType="long" order="AFTER">
 		select max(bno) from tbl_board
 		</selectKey>
 	</insert>
 	
 	<!-- 목록 조회 -->
 	<select id="list" resultType="domain.Board">
 		select * from tbl_board
 		<include refid="criteria"/>
 		order by bno desc 
 		limit #{amount} 
 		offset #{offset}
 	</select>
 	
 	<!-- 단일 조회 -->
 	<select id="selectOne" resultType="board">
 		select * 
 		from tbl_board 
 		where bno = #{bno}
 	</select>
 	
 	<!-- 게시글 갯수 -->
 	<select id="getCount" resultType="long">
 		select count(*) from tbl_board
		<include refid="criteria"></include>
 	</select>
 	
 	<!-- 글 수정 -->
 	<update id="update">
 		update tbl_board set
		title = #{title},
		content = #{content},
		moddate = now(),
		cno = #{cno}
		where bno = #{bno}
 	</update>
 	
 	<delete id="delete">
 		delete from tbl_board where bno = #{bno}
 	</delete>
 	
 	
 	<!-- 
 		#{var} = '${var}'
 	 -->
 </mapper>